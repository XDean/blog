<footer id="footer">
    <div class="container">
        &copy; {{ now.Format "2006" }} <a href="{{ .Site.BaseURL | absURL }}">{{ .Site.Title }}
            By {{ .Site.Author.name }}</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a
                href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        {{ if .Site.Params.showHostPage }}
            Hosted by <a rel="nofollow noreferer noopener" href="https://pages.coding.me" target="_blank">Coding
                Pages</a>.
        {{ end }}
    </div>
</footer>

{{ if .IsPage }}
    <!-- iframe -->
    <script type="text/javascript">
        (function () {
            Array.prototype.forEach.call(document.querySelectorAll("code[class=language-iframe]"), function (block) {
                const rootElement = block.parentNode;
                const container = document.createElement('div');
                container.className = 'align-center';
                container.setAttribute("style", "overFlow-x:auto");

                const iframe = document.createElement('iframe');
                iframe.setAttribute("src", block.innerText);
                iframe.className = "post-iframe";

                let isFullScreen = false;
                const button = document.createElement('button');
                button.innerText = "全屏";
                button.className = "post-iframe-button";
                button.onclick = function () {
                    if (isFullScreen) {
                        button.innerText = "全屏";
                        iframe.classList.remove("fullScreen");
                        button.classList.remove("fullScreen");
                    } else {
                        button.innerText = "取消全屏";
                        iframe.classList.add("fullScreen");
                        button.classList.add("fullScreen");
                    }
                    isFullScreen = !isFullScreen;
                };

                container.appendChild(iframe);
                container.appendChild(button);
                rootElement.parentNode.replaceChild(container, rootElement);
            });
        })();
    </script>

    <!-- graphviz -->
    {{- if and (or .Params.graphviz.enable (and .Site.Params.graphviz.enable (ne .Params.graphviz.enable false))) (or .IsPage .IsHome) -}}
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/1.7.1/viz.js"></script>
        <script type="text/javascript">
            (function () {
                if (!window.Viz) return;
                var vizPrefix = "language-viz-";
                var i = 0;
                Array.prototype.forEach.call(document.querySelectorAll("code[class^=" + vizPrefix + "]"), function (block) {
                    var engine;
                    block.getAttribute("class").split(" ").forEach(function (cls) {
                        if (cls.startsWith(vizPrefix)) {
                            engine = cls.substr(vizPrefix.length);
                        }
                    });
                    const rootElement = block.parentNode;
                    var image = new DOMParser().parseFromString(Viz(block.innerText, {
                        format: "svg",
                        engine: engine
                    }), "image/svg+xml");
                    const container = document.createElement('div');
                    container.className = 'align-center';
                    container.setAttribute("style", "overFlow-x:auto");
                    container.appendChild(image.documentElement);
                    rootElement.parentNode.replaceChild(container, rootElement);
                });
            })();
        </script>
    {{- end -}}

    <!-- flowchart -->
    {{- if and (or .Params.flowchartDiagrams.enable (and .Site.Params.flowchartDiagrams.enable (ne .Params.flowchartDiagrams.enable false))) (or .IsPage .IsHome) -}}
        <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.2.8/raphael.min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/flowchart/1.12.2/flowchart.min.js"
                crossorigin="anonymous"></script>
        <script>
            {{- if .Params.flowchartDiagrams.options -}}
            window.flowchartDiagramsOptions = {{ .Params.flowchartDiagrams.options | safeJS }};
            {{- else if .Site.Params.flowchartDiagrams.options -}}
            window.flowchartDiagramsOptions = {{ .Site.Params.flowchartDiagrams.options | safeJS }};
            {{- end -}}
            (function () {
                if (!window.flowchart) return;
                const blocks = document.querySelectorAll('pre code.language-flowchart, pre code.language-flow');
                for (let i = 0; i < blocks.length; i++) {
                    const block = blocks[i];
                    const rootElement = block.parentNode;
                    const container = document.createElement('div');
                    const id = `js-flowchart-diagrams-${i}`;
                    container.id = id;
                    container.className = 'align-center';
                    container.setAttribute("style", "overFlow-x:auto");
                    rootElement.parentNode.replaceChild(container, rootElement);
                    const diagram = flowchart.parse(block.childNodes[0].nodeValue);
                    diagram.drawSVG(id, window.flowchartDiagramsOptions ? window.flowchartDiagramsOptions : {});
                }
            })();
        </script>
    {{- end -}}

    <!-- line-highlight -->
    {{- if and (or .Params.graphviz.enable (and .Site.Params.graphviz.enable (ne .Params.graphviz.enable false))) (or .IsPage .IsHome) -}}
        <script type="text/javascript">
            (function () {
                Array.prototype.forEach.call(document.querySelectorAll("pre[class=line-numbers]"), function (block) {
                    const rootElement = block.parentNode;

                });
            })();
        </script>
    {{- end -}}

    <script type="text/javascript">
        //添加行号
        (function () {
            $("pre code").parent().addClass("line-numbers");

            // highlight
            Array.prototype.forEach.call(document.querySelectorAll("code[class^=language-]"), function (code) {
                const pre = code.parentNode;
                pre.classList.add("line-numbers");

                let highlight = "";
                let newTxt = code.innerHTML.split('\n').map(function (v, i) {
                    if (v.endsWith("//HL")) {
                        highlight = highlight + (i + 1) + ",";
                        return v.substring(0, v.length - 4);
                    } else if (v.endsWith("//HS")) {
                        highlight = highlight + (i + 1);
                        return v.substring(0, v.length - 4);
                    } else if (v.endsWith("//HE")) {
                        highlight = highlight + "-" + (i + 1) + ",";
                        return v.substring(0, v.length - 4);
                    } else {
                        return v;
                    }
                }).reduce(function (a, b) {
                    return a + '\n' + b
                });
                code.innerHTML = newTxt;
                highlight = highlight.substring(0, highlight.length - 1);
                pre.setAttribute("data-line", highlight)
            });
        }());

        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
            }
        };
    </script>
    <script type="text/javascript" src="{{ "js/prism.js" | relURL}}" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'
            async></script>
{{ end }}

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="{{ "js/totop.js?v=0.0.0" | relURL }}" async=""></script>
{{ template "_internal/google_analytics_async.html" . }}

{{ if .Site.Params.busuanzi }}
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
{{ end }}

<!-- custom js -->
{{ range .Site.Params.customJS }}
    <script src="{{ "/js/" | relURL }}{{ . }}"></script>
{{ end }}